// Generated by CoffeeScript 1.6.2
(function() {
  var disableSubmits, enableSubmits, fancy_that_center;

  $(document).ready(function() {
    $('a').mouseHovers();
    fancy_that_center('init');
    $('.main h1').fitText(0.7, {
      maxFontSize: '100px'
    });
    $('.main h2').fitText(1.7, {
      maxFontSize: '42px'
    });
    $('.panels > div').fitText(2.2, {
      maxFontSize: '18px',
      minFontSize: '12px'
    });
    $('form').ajaxForm({
      beforeSubmit: disableSubmits,
      success: enableSubmits,
      resetForm: true,
      timeout: 1000
    });
    return $('.main, .panels > div').fancyPanels();
  });

  $.fn.serializeObject = function() {
    var a, o;

    o = {};
    a = this.serializeArray();
    $.each(a, function() {
      if (o[this.name] !== undefined) {
        if (!o[this.name].push) {
          o[this.name] = [o[this.name]];
        }
        return o[this.name].push(this.value || "");
      } else {
        return o[this.name] = this.value || "";
      }
    });
    return o;
  };

  fancy_that_center = function() {
    if (arguments[0] === 'init') {
      $(window).resize(fancy_that_center);
    }
    $('.panels > div').each(function() {
      return $(this).centerVertically();
    });
    return $('.main .content').centerVertically();
  };

  jQuery.fn.mouseHovers = function() {
    return $(this).hover(function() {
      return $(this).clearQueue().animate({
        opacity: $(this).css('background-image') !== '' ? 0.6 : void 0
      }, 70);
    }, function() {
      return $(this).animate({
        opacity: 1
      }, 200);
    });
  };

  jQuery.fn.centerVertically = function() {
    var bottom, top;

    top = Math.max(0, (($(window).height() - $(this).height()) / 2) - 50);
    bottom = Math.max(0, $(window).height() - $(this).height() - top - 50);
    this.css("padding-top", top + "px");
    this.css("padding-bottom", bottom + "px");
    return this;
  };

  disableSubmits = function(formData, jqForm, options) {
    var emailFilter, error;

    $(jqForm).find('.error').removeClass('error');
    $(jqForm).find('.response').remove();
    $(jqForm).find('button[type=submit], input[type=submit]').each(function() {
      $(this).data('original-text', $(this).text());
      return $(this).attr("disabled", "disabled").text('Please Wait...');
    });
    error = false;
    emailFilter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
    if ($(jqForm).find('input[name="name"]').val().trim().length === 0) {
      $(jqForm).find('input[name="name"]').parents('.control-group').addClass('error');
      error = true;
    }
    if (!emailFilter.test($(jqForm).find('input[name="email"]').val())) {
      $(jqForm).find('input[name="email"]').parents('.control-group').addClass('error');
      error = true;
    }
    if ($(jqForm).find('select[name="subject"]')[0].selectedIndex <= 0) {
      $(jqForm).find('select[name="subject"]').parents('.control-group').addClass('error');
      error = true;
    }
    if ($(jqForm).find('textarea[name="comments"]').val().trim().length === 0) {
      $(jqForm).find('textarea[name="comments"]').parents('.control-group').addClass('error');
      error = true;
    }
    if (error) {
      $(jqForm).find('button[type=submit], input[type=submit]').each(function() {
        return $(this).removeAttr("disabled").text($(this).data('original-text')).after('<span class="response"><span class="label label-important">Please fill in the required fields</span></span>');
      });
      $(jqForm).find('.response').fadeIn(300);
      return false;
    }
  };

  enableSubmits = function(responseText, statusText, xhr, $form) {
    $form.find('button[type=submit], input[type=submit]').each(function() {
      return $(this).removeAttr("disabled").text($(this).data('original-text')).after('<span class="response"><span class="label label-success">Sent, thank you!</span></span>');
    });
    return $form.find('.response').fadeIn(300);
  };

  jQuery.fn.getHorizontalCenterOffset = function() {
    return Math.min(0, ($(window).width() / 2 - $(this).offset().left - $(this).css('margin-right').replace(/[^-\d\.]/g, '') - $(this).width() / 2) * -1);
  };

  jQuery.fn.fancyPanels = function() {
    var centerHomepage, firstHash, homepage, newHash, panels, params, possibleHashes, that, _i, _len, _ref;

    if (window.fancyPanels === void 0) {
      window.fancyPanels = [];
      params = arguments[0] || [];
      that = this;
      $(window).hashchange(function() {
        return $(that).fancyPanels();
      });
      $(window).resize(function() {
        return centerHomepage();
      });
      $('.main').css('top', $(window).height() + "px");
      firstHash = true;
    } else {
      firstHash = false;
    }
    newHash = window.location.hash.split('#')[1] || '';
    possibleHashes = [];
    _ref = $(this);
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      panels = _ref[_i];
      if ($(panels).data('hash')) {
        possibleHashes.push($(panels).data('hash'));
      }
    }
    homepage = newHash === 'home' || newHash === '' || $.inArray(newHash, possibleHashes) === -1;
    centerHomepage = function() {
      if (homepage) {
        return $('.main').css('margin-right', $('.main').getHorizontalCenterOffset());
      }
    };
    if (firstHash) {
      centerHomepage();
      $('.main').animate({
        top: 0,
        opacity: 1
      }, 1600, 'swing');
      $('.panels > div').animate({
        opacity: 1
      }, 1600, 'swing');
      if (!homepage) {
        $('.stripes').fadeIn(1600);
      }
    }
    if (homepage) {
      if (!firstHash) {
        $('.main').clearQueue();
        $('.main').animate({
          "margin-right": $('.main').getHorizontalCenterOffset()
        }, 1600, 'swing');
        $('.stripes').fadeOut(1600);
      }
    } else {
      $('.stripes').fadeIn(1600);
      $('.main').clearQueue();
      $('.main').animate({
        "margin-right": "0px"
      }, 1600, 'swing');
    }
    if ($.inArray(newHash, possibleHashes) === -1) {
      $('html, body').animate({
        scrollTop: 0
      }, 1600, 'swing');
    } else if ($(window).scrollTop() !== $("[data-hash=" + newHash + "]").offset().top || window.fancyPanels.currentHash !== newHash) {
      $('html, body').clearQueue();
      $('html, body').animate({
        scrollTop: $("[data-hash=" + newHash + "]").offset().top
      }, 1600, 'swing');
    }
    return window.fancyPanels.currentHash = newHash;
  };

}).call(this);
